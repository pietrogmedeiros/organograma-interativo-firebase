// Configura√ß√£o do Firebase (desabilitada temporariamente)
// const firebaseConfig = {
//     apiKey: "AIzaSyBxGJwTzXzXzXzXzXzXzXzXzXzXzXzXzX",
//     authDomain: "organograma-webcontinental.firebaseapp.com",
//     projectId: "organograma-webcontinental",
//     storageBucket: "organograma-webcontinental.appspot.com",
//     messagingSenderId: "123456789",
//     appId: "1:123456789:web:abcdef123456"
// };

// Inicializar Firebase (desabilitado temporariamente)
// firebase.initializeApp(firebaseConfig);
// const db = firebase.firestore();

// Vari√°veis globais
let colaboradoresData = [];
let currentHierarchyLevel = 'presidencia';
let currentSelectedPerson = null;
let navigationHistory = [];

// Fun√ß√£o para garantir que o Google Charts est√° carregado
function ensureGoogleChartsLoaded() {
    return new Promise((resolve) => {
        if (window.google && window.google.charts) {
            resolve();
        } else {
            google.charts.load('current', { packages: ['orgchart'] });
            google.charts.setOnLoadCallback(resolve);
        }
    });
}

// Inicializar sidebar
function initializeSidebar() {
    const sidebar = document.querySelector('.sidebar');
    if (!sidebar) return;

    const menuItems = sidebar.querySelectorAll('li');
    menuItems.forEach(item => {
        item.addEventListener('click', () => {
            const view = item.getAttribute('data-view');
            console.log('üéØ Menu clicado:', view);
            
            if (view === 'presidencia') {
                // Resetar navega√ß√£o hier√°rquica
                currentHierarchyLevel = 'presidencia';
                currentSelectedPerson = null;
                navigationHistory = [];
                renderPresidenciaView();
            } else if (view === 'departamentos') {
                renderAllDepartmentsView();
            }
        });
    });
}

// Carregar dados iniciais
async function loadInitialData() {
    try {
        console.log('üìä Carregando dados locais...');
        
        // Carregar dados do arquivo output.json
        const response = await fetch('output.json');
        if (!response.ok) {
            throw new Error('N√£o foi poss√≠vel carregar os dados');
        }
        
        colaboradoresData = await response.json();
        console.log(`‚úÖ ${colaboradoresData.length} colaboradores carregados`);
        
        // Popular seletor de departamentos
        populateDepartmentSelector();
        
        // Renderizar view inicial
        renderPresidenciaView();
        
    } catch (error) {
        console.error('‚ùå Erro ao carregar dados:', error);
        setErrorState('Erro ao carregar dados: ' + error.message);
    }
}

// Popular seletor de departamentos
function populateDepartmentSelector() {
    const selector = document.getElementById('department-selector');
    if (!selector) return;
    
    const departamentos = [...new Set(colaboradoresData.map(col => col.Departamento))].filter(Boolean).sort();
    
    selector.innerHTML = '<option value="">Todos os Departamentos</option>';
    departamentos.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept;
        option.textContent = dept;
        selector.appendChild(option);
    });
}

// Renderizar view de todos os departamentos
function renderAllDepartmentsView() {
    const container = document.getElementById('chart-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const title = document.createElement('h2');
    title.textContent = 'Todos os Departamentos';
    title.style.cssText = `
        text-align: center;
        margin: 0 0 30px 0;
        font-size: 28px;
        font-weight: 700;
        color: #1e40af;
    `;
    container.appendChild(title);
    
    const departamentos = [...new Set(colaboradoresData.map(col => col.Departamento))].filter(Boolean).sort();
    
    const grid = document.createElement('div');
    grid.style.cssText = `
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        padding: 20px 0;
    `;
    
    departamentos.forEach(dept => {
        const deptCard = document.createElement('div');
        deptCard.style.cssText = `
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        `;
        
        const deptTitle = document.createElement('h3');
        deptTitle.textContent = dept;
        deptTitle.style.cssText = `
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 10px 0;
            color: #1f2937;
        `;
        
        const deptCount = document.createElement('p');
        const count = colaboradoresData.filter(col => col.Departamento === dept).length;
        deptCount.textContent = `${count} colaboradores`;
        deptCount.style.cssText = `
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        `;
        
        deptCard.appendChild(deptTitle);
        deptCard.appendChild(deptCount);
        
        deptCard.addEventListener('mouseenter', () => {
            deptCard.style.transform = 'translateY(-2px)';
            deptCard.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        });
        
        deptCard.addEventListener('mouseleave', () => {
            deptCard.style.transform = 'translateY(0)';
            deptCard.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
        });
        
        deptCard.addEventListener('click', () => {
            renderSingleDepartmentView(dept);
        });
        
        grid.appendChild(deptCard);
    });
    
    container.appendChild(grid);
}

// Renderizar view de departamento espec√≠fico
function renderSingleDepartmentView(departmentName) {
    const container = document.getElementById('chart-container');
    if (!container) return;
    
    const colaboradores = colaboradoresData.filter(col => col.Departamento === departmentName);
    
    container.innerHTML = '';
    
    const title = document.createElement('h2');
    title.textContent = `Departamento: ${departmentName}`;
    title.style.cssText = `
        text-align: center;
        margin: 0 0 30px 0;
        font-size: 28px;
        font-weight: 700;
        color: #1e40af;
    `;
    container.appendChild(title);
    
    // Criar visualiza√ß√£o hier√°rquica
    createHierarchicalView(container, colaboradores, departmentName);
}

// Renderizar view da presid√™ncia
function renderPresidenciaView() {
    console.log('üéØ Renderizando view da presid√™ncia');
    
    const container = document.getElementById('chart-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const title = document.createElement('h2');
    title.textContent = 'Presid√™ncia - Diretores';
    title.style.cssText = `
        text-align: center;
        margin: 0 0 30px 0;
        font-size: 28px;
        font-weight: 700;
        color: #1e40af;
    `;
    container.appendChild(title);
    
    // Buscar diretores
    const diretores = colaboradoresData.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return cargo.includes('diretor') || cargo.includes('diretora');
    });
    
    console.log(`üëî Diretores encontrados: ${diretores.length}`, diretores);
    
    if (diretores.length === 0) {
        const noData = document.createElement('p');
        noData.textContent = 'Nenhum diretor encontrado.';
        noData.style.cssText = `
            text-align: center;
            color: #64748b;
            font-size: 16px;
            margin-top: 30px;
        `;
        container.appendChild(noData);
        return;
    }
    
    // Container dos diretores
    const diretoresContainer = document.createElement('div');
    diretoresContainer.style.cssText = `
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        padding: 20px 0;
    `;
    
    diretores.forEach(diretor => {
        const diretorCard = document.createElement('div');
        diretorCard.style.cssText = `
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        `;
        
        const diretorNome = document.createElement('h3');
        diretorNome.textContent = diretor.Colaborador;
        diretorNome.style.cssText = `
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 10px 0;
        `;
        
        const diretorCargo = document.createElement('p');
        diretorCargo.textContent = diretor.Cargo;
        diretorCargo.style.cssText = `
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 8px 0;
            opacity: 0.9;
        `;
        
        const diretorDept = document.createElement('p');
        diretorDept.textContent = diretor.Departamento;
        diretorDept.style.cssText = `
            font-size: 12px;
            opacity: 0.8;
            margin: 0;
        `;
        
        diretorCard.appendChild(diretorNome);
        diretorCard.appendChild(diretorCargo);
        diretorCard.appendChild(diretorDept);
        
        // Adicionar eventos de hover e clique
        diretorCard.addEventListener('mouseenter', () => {
            diretorCard.style.transform = 'translateY(-3px)';
            diretorCard.style.boxShadow = '0 8px 25px rgba(59, 130, 246, 0.4)';
        });
        
        diretorCard.addEventListener('mouseleave', () => {
            diretorCard.style.transform = 'translateY(0)';
            diretorCard.style.boxShadow = '0 6px 20px rgba(59, 130, 246, 0.3)';
        });
        
        diretorCard.addEventListener('click', () => {
            navigateToNextLevel(diretor, 'diretor');
        });
        
        diretoresContainer.appendChild(diretorCard);
    });
    
    container.appendChild(diretoresContainer);
}

// Navegar para o pr√≥ximo n√≠vel hier√°rquico
function navigateToNextLevel(person, currentLevel) {
    console.log('üéØ DEBUG navigateToNextLevel:', person.Colaborador, 'n√≠vel atual:', currentLevel);
    
    // Salvar estado atual no hist√≥rico
    navigationHistory.push({
        person: currentSelectedPerson,
        level: currentHierarchyLevel
    });
    
    console.log(`üéØ Estado atual: currentHierarchyLevel = ${currentHierarchyLevel}`);
    
    // Determinar pr√≥ximo n√≠vel
    let nextLevel = getNextLevel(currentLevel);
    console.log('üéØ getNextLevel retornou:', nextLevel);
    
    if (nextLevel === 'auto') {
        nextLevel = detectNextLevel(person);
        console.log('üéØ detectNextLevel retornou:', nextLevel);
    }
    
    // Atualizar estado
    currentHierarchyLevel = nextLevel;
    currentSelectedPerson = person;
    console.log('üéØ Estado atualizado - currentHierarchyLevel:', currentHierarchyLevel);
    
    // Renderizar pr√≥ximo n√≠vel
    renderHierarchyLevel(person, currentLevel);
}

// Determinar pr√≥ximo n√≠vel baseado no n√≠vel atual
function getNextLevel(currentLevel) {
    console.log(`üéØ getNextLevel chamado com: ${currentLevel}`);
    const levelMap = {
        'presidencia': 'diretor',
        'diretor': 'auto', // Ser√° determinado automaticamente
        'gerente': 'auto', // Ser√° determinado automaticamente
        'coordenador': 'auto', // Ser√° determinado automaticamente
        'supervisor': 'colaborador'
    };
    const result = levelMap[currentLevel] || 'colaborador';
    console.log(`üéØ getNextLevel retornando: ${result}`);
    return result;
}

// Detectar pr√≥ximo n√≠vel dinamicamente
function detectNextLevel(person) {
    console.log('üîç DEBUG detectNextLevel:', person.Colaborador);
    
    // Buscar todos os subordinados diretos
    const subordinados = colaboradoresData.filter(col => {
        const gestor = (col.Gestor || '').toLowerCase();
        const nomePessoa = person.Colaborador.toLowerCase();
        const match = gestor.includes(nomePessoa);
        console.log(`üîç Comparando: "${gestor}" com "${nomePessoa}" = ${match}`);
        return match;
    });
    
    console.log('üìä Subordinados encontrados:', subordinados.length);
    subordinados.forEach((sub, i) => {
        console.log(`${i+1}. ${sub.Colaborador} - ${sub.Cargo} - Gestor: ${sub.Gestor}`);
    });
    
    if (subordinados.length === 0) {
        console.log('‚ùå Nenhum subordinado encontrado, retornando colaborador');
        return 'colaborador';
    }
    
    // Analisar cargos dos subordinados para determinar o pr√≥ximo n√≠vel
    const cargos = subordinados.map(col => (col.Cargo || '').toLowerCase());
    console.log('üîç Cargos dos subordinados:', cargos);
    
    // Verificar se h√° gerentes/heads
    const temGerentes = cargos.some(cargo => 
        cargo.includes('gerente') || 
        cargo.includes('head') || 
        cargo.includes('manager')
    );
    
    // Verificar se h√° coordenadores
    const temCoordenadores = cargos.some(cargo => 
        cargo.includes('coordenador') || 
        cargo.includes('coordinator')
    );
    
    // Verificar se h√° supervisores
    const temSupervisores = cargos.some(cargo => 
        cargo.includes('supervisor') || 
        cargo.includes('supervisora')
    );
    
    // Verificar se h√° diretores (caso raro, mas poss√≠vel)
    const temDiretores = cargos.some(cargo => 
        cargo.includes('diretor') || 
        cargo.includes('diretora')
    );
    
    console.log('üîç An√°lise de cargos:', {
        temDiretores,
        temGerentes,
        temCoordenadores,
        temSupervisores
    });
    
    // Seguir a hierarquia exata: Diretores > Gerentes > Coordenadores > Supervisores > Colaboradores
    if (temDiretores) {
        console.log('üéØ Retornando: diretor');
        return 'diretor';
    }
    if (temGerentes) {
        console.log('üéØ Retornando: gerente');
        return 'gerente';
    }
    if (temCoordenadores) {
        console.log('üéØ Retornando: coordenador');
        return 'coordenador';
    }
    if (temSupervisores) {
        console.log('üéØ Retornando: supervisor');
        return 'supervisor';
    }
    
    console.log('üéØ Retornando: colaborador (fallback)');
    return 'colaborador';
}

// Renderizar n√≠vel hier√°rquico
function renderHierarchyLevel(person, previousLevel) {
    console.log('üéØ DEBUG renderHierarchyLevel:', person.Colaborador, 'n√≠vel:', currentHierarchyLevel);
    
    const container = document.getElementById('chart-container');
    if (!container) {
        console.error('‚ùå Container n√£o encontrado!');
        return;
    }
    
    // Limpar container
    container.innerHTML = '';
    
    // Adicionar breadcrumb
    addBreadcrumb(container);
    
    // Usar fun√ß√£o gen√©rica para renderizar qualquer n√≠vel
    console.log('üéØ Chamando renderSubordinadosView com n√≠vel:', currentHierarchyLevel);
    renderSubordinadosView(person, currentHierarchyLevel);
}

// Fun√ß√£o gen√©rica para renderizar qualquer n√≠vel
function renderSubordinadosView(pessoa, nivelAtual) {
    console.log('üéØ DEBUG renderSubordinadosView:', pessoa.Colaborador, 'n√≠vel:', nivelAtual);
    
    const container = document.getElementById('chart-container');
    if (!container) return;
    
    // Buscar subordinados diretos
    const subordinados = colaboradoresData.filter(col => {
        const gestor = (col.Gestor || '').toLowerCase();
        const nomePessoa = pessoa.Colaborador.toLowerCase();
        return gestor.includes(nomePessoa);
    });
    
    console.log(`üìä Subordinados encontrados: ${subordinados.length}`, subordinados);
    
    // T√≠tulo gen√©rico - mostrar todos os subordinados
    const title = document.createElement('h2');
    title.textContent = `Subordinados - ${pessoa.Colaborador}`;
    title.style.cssText = `
        text-align: center;
        margin: 0 0 30px 0;
        font-size: 28px;
        font-weight: 700;
        color: #1e40af;
    `;
    container.appendChild(title);
    
    // Card da pessoa atual (contexto)
    const pessoaCard = document.createElement('div');
    const cores = {
        'diretor': 'linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)',
        'gerente': 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
        'coordenador': 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
        'supervisor': 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',
        'colaborador': 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'
    };
    
    pessoaCard.style.cssText = `
        background: ${cores[nivelAtual] || cores['colaborador']};
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 30px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    `;
    
    const pessoaNome = document.createElement('h3');
    pessoaNome.textContent = pessoa.Colaborador;
    pessoaNome.style.cssText = `
        font-size: 20px;
        font-weight: 700;
        margin: 0 0 8px 0;
    `;
    
    const pessoaCargo = document.createElement('p');
    pessoaCargo.textContent = pessoa.Cargo;
    pessoaCargo.style.cssText = `
        font-size: 14px;
        font-weight: 600;
        margin: 0;
        opacity: 0.9;
    `;
    
    pessoaCard.appendChild(pessoaNome);
    pessoaCard.appendChild(pessoaCargo);
    container.appendChild(pessoaCard);
    
    if (subordinados.length === 0) {
        const noData = document.createElement('p');
        noData.textContent = `Nenhum subordinado encontrado para ${pessoa.Colaborador}.`;
        noData.style.cssText = `
            text-align: center;
            color: #64748b;
            font-size: 16px;
            margin-top: 30px;
        `;
        container.appendChild(noData);
        return;
    }
    
    // Agrupar subordinados por tipo de cargo
    const diretores = subordinados.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return cargo.includes('diretor') || cargo.includes('diretora');
    });
    
    const gerentes = subordinados.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return cargo.includes('gerente') || cargo.includes('head') || cargo.includes('manager');
    });
    
    const coordenadores = subordinados.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return cargo.includes('coordenador') || cargo.includes('coordinator');
    });
    
    const supervisores = subordinados.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return cargo.includes('supervisor') || cargo.includes('supervisora');
    });
    
    const colaboradores = subordinados.filter(col => {
        const cargo = (col.Cargo || '').toLowerCase();
        return !cargo.includes('diretor') && 
               !cargo.includes('gerente') && 
               !cargo.includes('head') && 
               !cargo.includes('manager') &&
               !cargo.includes('coordenador') && 
               !cargo.includes('coordinator') &&
               !cargo.includes('supervisor') && 
               !cargo.includes('supervisora');
    });
    
    // Renderizar cada grupo em ordem hier√°rquica
    if (diretores.length > 0) {
        renderGrupoSubordinados(container, diretores, 'diretor', pessoa);
    }
    
    if (gerentes.length > 0) {
        renderGrupoSubordinados(container, gerentes, 'gerente', pessoa);
    }
    
    if (coordenadores.length > 0) {
        renderGrupoSubordinados(container, coordenadores, 'coordenador', pessoa);
    }
    
    if (supervisores.length > 0) {
        renderGrupoSubordinados(container, supervisores, 'supervisor', pessoa);
    }
    
    if (colaboradores.length > 0) {
        renderGrupoSubordinados(container, colaboradores, 'colaborador', pessoa);
    }
}

// Renderizar grupo de subordinados
function renderGrupoSubordinados(container, subordinados, tipo, gestor) {
    const titulos = {
        'diretor': 'Diretores',
        'gerente': 'Gerentes',
        'coordenador': 'Coordenadores',
        'supervisor': 'Supervisores',
        'colaborador': 'Colaboradores'
    };
    
    const titulo = document.createElement('h3');
    titulo.textContent = titulos[tipo];
    titulo.style.cssText = `
        font-size: 20px;
        font-weight: 600;
        color: #374151;
        margin: 30px 0 15px 0;
        text-align: center;
    `;
    container.appendChild(titulo);
    
    const subordinadosContainer = document.createElement('div');
    subordinadosContainer.style.cssText = `
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px 0;
    `;
    
    subordinados.forEach(subordinado => {
        const card = createColaboradorCard(subordinado, tipo);
        
        // Adicionar eventos de hover e clique
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-2px)';
            card.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        });
        
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
            card.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
        });
        
        card.addEventListener('click', () => {
            const proximoNivel = detectNextLevel(subordinado);
            navigateToNextLevel(subordinado, proximoNivel);
        });
        
        subordinadosContainer.appendChild(card);
    });
    
    container.appendChild(subordinadosContainer);
}

// Adicionar breadcrumb
function addBreadcrumb(container) {
    const breadcrumb = document.createElement('div');
    breadcrumb.style.cssText = `
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    `;
    
    const backButton = document.createElement('button');
    backButton.textContent = '‚Üê Voltar';
    backButton.style.cssText = `
        background: #3b82f6;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s;
    `;
    
    backButton.addEventListener('mouseenter', () => {
        backButton.style.background = '#2563eb';
    });
    
    backButton.addEventListener('mouseleave', () => {
        backButton.style.background = '#3b82f6';
    });
    
    backButton.addEventListener('click', goBack);
    
    const path = document.createElement('span');
    path.textContent = `Presid√™ncia > ${currentSelectedPerson ? currentSelectedPerson.Colaborador : ''}`;
    path.style.cssText = `
        color: #64748b;
        font-size: 14px;
    `;
    
    breadcrumb.appendChild(backButton);
    breadcrumb.appendChild(path);
    container.appendChild(breadcrumb);
}

// Voltar para n√≠vel anterior
function goBack() {
    if (navigationHistory.length === 0) {
        // Se n√£o h√° hist√≥rico, voltar para presid√™ncia
        currentHierarchyLevel = 'presidencia';
        currentSelectedPerson = null;
        navigationHistory = [];
        renderPresidenciaView();
        return;
    }
    
    const previousState = navigationHistory.pop();
    currentHierarchyLevel = previousState.level;
    currentSelectedPerson = previousState.person;
    
    if (currentHierarchyLevel === 'presidencia') {
        renderPresidenciaView();
    } else {
        const previousLevel = getPreviousLevel(currentHierarchyLevel);
        renderHierarchyLevel(currentSelectedPerson, previousLevel);
    }
}

// Determinar n√≠vel anterior
function getPreviousLevel(currentLevel) {
    const levelMap = {
        'diretor': 'presidencia',
        'gerente': 'auto',
        'coordenador': 'auto',
        'supervisor': 'auto',
        'colaborador': 'auto'
    };
    return levelMap[currentLevel] || 'presidencia';
}

// Criar card de colaborador
function createColaboradorCard(colaborador, tipo) {
    const nome = (colaborador.Colaborador || colaborador.Nome || colaborador['Nome do Colaborador'] || '').trim();
    const cargo = (colaborador.Cargo || '').trim();
    const departamento = (colaborador.Departamento || '').trim();
    
    const card = document.createElement('div');
    card.className = `colaborador-card ${tipo}-card`;
    
    // Definir estilos baseados no tipo
    let cardStyles, nomeStyles, cargoStyles, deptStyles, hoverShadow;
    
    switch(tipo) {
        case 'gerente':
            cardStyles = `
                min-width: 220px;
                max-width: 280px;
                padding: 18px;
                background: linear-gradient(135deg, #eff6ff, #dbeafe);
                border: 3px solid #3b82f6;
                box-shadow: 0 6px 16px rgba(59, 130, 246, 0.25);
                border-radius: 12px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            nomeStyles = `
                font-weight: 700;
                font-size: 15px;
                color: #1e40af;
                margin-bottom: 8px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            cargoStyles = `
                font-size: 13px;
                color: #3730a3;
                font-weight: 600;
                line-height: 1.3;
                margin-bottom: 6px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            deptStyles = `
                font-size: 11px;
                color: #6366f1;
                font-weight: 500;
                line-height: 1.2;
                padding: 3px 8px;
                background: rgba(99, 102, 241, 0.1);
                border-radius: 6px;
                margin-top: 6px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            hoverShadow = '0 8px 24px rgba(59, 130, 246, 0.35)';
            break;
            
        case 'coordenador':
            cardStyles = `
                min-width: 200px;
                max-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, #f0fdfa, #ccfbf1);
                border: 2px solid #06b6d4;
                box-shadow: 0 4px 14px rgba(6, 182, 212, 0.2);
                border-radius: 10px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            nomeStyles = `
                font-weight: 700;
                font-size: 14px;
                color: #0f766e;
                margin-bottom: 6px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            cargoStyles = `
                font-size: 12px;
                color: #0d9488;
                font-weight: 600;
                line-height: 1.3;
                margin-bottom: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            deptStyles = `
                font-size: 10px;
                color: #0891b2;
                font-weight: 500;
                line-height: 1.2;
                padding: 2px 6px;
                background: rgba(6, 182, 212, 0.1);
                border-radius: 4px;
                margin-top: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            hoverShadow = '0 6px 20px rgba(6, 182, 212, 0.3)';
            break;
            
        case 'supervisor':
            cardStyles = `
                min-width: 180px;
                max-width: 220px;
                padding: 14px;
                background: linear-gradient(135deg, #fefce8, #fef3c7);
                border: 2px solid #f59e0b;
                box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
                border-radius: 9px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            nomeStyles = `
                font-weight: 600;
                font-size: 13px;
                color: #92400e;
                margin-bottom: 6px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            cargoStyles = `
                font-size: 11px;
                color: #a16207;
                font-weight: 500;
                line-height: 1.3;
                margin-bottom: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            deptStyles = `
                font-size: 9px;
                color: #d97706;
                font-weight: 500;
                line-height: 1.2;
                padding: 2px 6px;
                background: rgba(245, 158, 11, 0.1);
                border-radius: 4px;
                margin-top: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            hoverShadow = '0 5px 18px rgba(245, 158, 11, 0.3)';
            break;
            
        case 'colaborador':
            cardStyles = `
                min-width: 160px;
                max-width: 200px;
                padding: 12px;
                background: linear-gradient(135deg, #f9fafb, #f3f4f6);
                border: 2px solid #d1d5db;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
                border-radius: 8px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            nomeStyles = `
                font-weight: 600;
                font-size: 12px;
                color: #374151;
                margin-bottom: 4px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            cargoStyles = `
                font-size: 10px;
                color: #6b7280;
                font-weight: 500;
                line-height: 1.3;
                margin-bottom: 3px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            deptStyles = `
                font-size: 8px;
                color: #9ca3af;
                font-weight: 500;
                line-height: 1.2;
                padding: 1px 4px;
                background: rgba(156, 163, 175, 0.1);
                border-radius: 3px;
                margin-top: 3px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            hoverShadow = '0 4px 15px rgba(0, 0, 0, 0.15)';
            break;
            
        default:
            cardStyles = `
                min-width: 200px;
                max-width: 250px;
                padding: 16px;
                background: white;
                border: 2px solid #e5e7eb;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                border-radius: 10px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            nomeStyles = `
                font-weight: 600;
                font-size: 14px;
                color: #1f2937;
                margin-bottom: 6px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            cargoStyles = `
                font-size: 12px;
                color: #6b7280;
                font-weight: 500;
                line-height: 1.3;
                margin-bottom: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            deptStyles = `
                font-size: 10px;
                color: #9ca3af;
                font-weight: 500;
                line-height: 1.2;
                padding: 2px 6px;
                background: rgba(156, 163, 175, 0.1);
                border-radius: 4px;
                margin-top: 4px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            `;
            hoverShadow = '0 6px 18px rgba(0, 0, 0, 0.15)';
    }
    
    card.style.cssText = cardStyles;
    
    const nomeElement = document.createElement('h3');
    nomeElement.textContent = nome;
    nomeElement.style.cssText = nomeStyles;
    
    const cargoElement = document.createElement('p');
    cargoElement.textContent = cargo;
    cargoElement.style.cssText = cargoStyles;
    
    const deptElement = document.createElement('p');
    deptElement.textContent = departamento;
    deptElement.style.cssText = deptStyles;
    
    card.appendChild(nomeElement);
    card.appendChild(cargoElement);
    card.appendChild(deptElement);
    
    return card;
}

// Criar visualiza√ß√£o hier√°rquica
function createHierarchicalView(container, colaboradores, deptName) {
    const title = document.createElement('h3');
    title.textContent = `Estrutura Hier√°rquica - ${deptName}`;
    title.style.cssText = `
        text-align: center;
        margin: 20px 0;
        font-size: 20px;
        font-weight: 600;
        color: #374151;
    `;
    container.appendChild(title);
    
    // Fun√ß√£o para determinar prioridade do cargo
    const getPriority = (cargo) => {
        const cargoLower = cargo.toLowerCase();
        if (cargoLower.includes('diretor')) return 1;
        if (cargoLower.includes('gerente') || cargoLower.includes('head') || cargoLower.includes('manager')) return 2;
        if (cargoLower.includes('coordenador') || cargoLower.includes('coordinator')) return 3;
        if (cargoLower.includes('supervisor')) return 4;
        return 5; // colaboradores
    };
    
    // Ordenar colaboradores por prioridade
    const sortedColaboradores = colaboradores.sort((a, b) => {
        return getPriority(a.Cargo) - getPriority(b.Cargo);
    });
    
    // Criar visualiza√ß√£o em cards
    const cardsContainer = document.createElement('div');
    cardsContainer.style.cssText = `
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px 0;
    `;
    
    sortedColaboradores.forEach(colaborador => {
        const card = createColaboradorCard(colaborador, 'default');
        cardsContainer.appendChild(card);
    });
    
    container.appendChild(cardsContainer);
}

// Fun√ß√µes auxiliares
function setActiveButton(activeButton) {
    document.querySelectorAll('.sidebar li').forEach(item => item.classList.remove('active'));
    activeButton.classList.add('active');
}

function setLoadingState(message) {
    const container = document.getElementById('chart-container');
    if (container) {
        container.innerHTML = `<div style="text-align: center; padding: 40px; color: #64748b;">${message}</div>`;
    }
}

function setErrorState(message) {
    const container = document.getElementById('chart-container');
    if (container) {
        container.innerHTML = `<div style="text-align: center; padding: 40px; color: #dc2626;">‚ùå ${message}</div>`;
    }
}

function setReadyState(message) {
    const container = document.getElementById('chart-container');
    if (container) {
        container.innerHTML = `<div style="text-align: center; padding: 40px; color: #059669;">‚úÖ ${message}</div>`;
    }
}

// Inicializar aplica√ß√£o
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üöÄ Inicializando aplica√ß√£o...');
    
    // Garantir que o Google Charts est√° carregado
    await ensureGoogleChartsLoaded();
    
    // Inicializar sidebar
    initializeSidebar();
    
    // Carregar dados
    await loadInitialData();
    
    console.log('‚úÖ Aplica√ß√£o inicializada com sucesso!');
}); 